<!doctype html>
<html lang="en-us">
  <head>
    <meta charset="utf-8" />
    <title>Git Diff HTML Viewer</title>

    <!-- Highlight.js CSS -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.1/styles/github.min.css"
    />

    <!-- Diff2Html CSS -->
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css"
    />

    <!-- Diff2Html JS -->
    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js"
    ></script>

    <style>
      body {
        font-family: system-ui, sans-serif;
        background: #f5f5f5;
        color: #111;
        padding: 2rem;
      }
      #myDiffElement {
        margin-top: 1.5rem;
        border: 1px solid #ddd;
        border-radius: 8px;
        background: white;
        overflow: auto;
        max-height: 80vh;
      }
      .controls {
        display: flex;
        gap: 1rem;
        align-items: center;
        margin-bottom: 1rem;
      }
      button,
      label {
        background: #2563eb;
        color: white;
        border: none;
        border-radius: 6px;
        padding: 0.5rem 1rem;
        cursor: pointer;
      }
      input[type="file"] {
        display: none;
      }
      button:hover,
      label:hover {
        background: #1e40af;
      }
      select {
        padding: 0.4rem 0.6rem;
        border-radius: 6px;
        border: 1px solid #ccc;
      }
    </style>
  </head>

  <body>
    <h1>üîç Git Diff HTML Viewer</h1>

    <div class="controls">
      <!-- Ch·ªçn file -->
      <label for="diffFile">üìÇ Choose .diff / .patch file</label>
      <input type="file" id="diffFile" accept=".diff,.patch,.txt" />

      <!-- Ch·ªçn ki·ªÉu view -->
      <select id="viewMode">
        <option value="side-by-side" selected>Side by side</option>
        <option value="line-by-line">Line by line</option>
      </select>
    </div>

    <div id="myDiffElement"></div>

    <script>
      const fileInput = document.getElementById("diffFile");
      const viewMode = document.getElementById("viewMode");
      const diffContainer = document.getElementById("myDiffElement");

      let diffText = "";

      fileInput.addEventListener("change", async (e) => {
        const file = e.target.files[0];
        if (!file) return;
        diffText = await file.text();
        renderDiff();
      });

      viewMode.addEventListener("change", () => {
        if (diffText) renderDiff();
      });

      function renderDiff() {
        diffContainer.innerHTML = "";
        const config = {
          drawFileList: true,
          fileListToggle: false,
          fileListStartVisible: false,
          fileContentToggle: false,
          matching: "lines",
          outputFormat: viewMode.value,
          synchronisedScroll: true,
          highlight: true,
          renderNothingWhenEmpty: false,
        };
        const diff2htmlUi = new Diff2HtmlUI(diffContainer, diffText, config);
        diff2htmlUi.draw();
        diff2htmlUi.highlightCode();
      }
    </script>
  </body>
</html>
