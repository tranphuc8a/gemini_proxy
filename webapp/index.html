<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Webapps</title>
    <style>
      :root {
        --bg: #0f1115;
        --bg-alt: #1a1f27;
        --bg-hover: #222a35;
        --border: #2b3542;
        --text: #f0f3f6;
        --text-dim: #9aa5b1;
        --accent: #4ea2f5;
        --accent-grad: linear-gradient(135deg,#4ea2f5,#7f54ff 60%,#ff6ec7);
        --radius: 14px;
        --shadow: 0 4px 16px -4px rgba(0,0,0,.5), 0 2px 6px -2px rgba(0,0,0,.4);
        --trans: 160ms cubic-bezier(.4,.2,.2,1);
      }
      * { box-sizing: border-box; }
      body { font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif; margin:0; padding:0; background: var(--bg); color: var(--text); -webkit-font-smoothing: antialiased; }
      header { padding: clamp(1.5rem,2.5vw,2.5rem) clamp(2rem,4vw,4rem) 1rem; display:flex; flex-direction:column; gap:1.2rem; }
  h1 { font-size: clamp(1.9rem,4vw,2.6rem); font-weight:600; letter-spacing:.5px; background: var(--accent-grad); -webkit-background-clip:text; background-clip:text; color: transparent; margin:0; }
      p.muted { margin:0; font-size:.95rem; color: var(--text-dim); max-width:740px; line-height:1.5; }
      .toolbar { display:flex; flex-wrap:wrap; gap:.75rem; align-items:center; }
      .search-wrap { position:relative; flex:1 1 260px; }
      .search-wrap input { width:100%; padding:.75rem 1rem .75rem 2.6rem; background: var(--bg-alt); border:1px solid var(--border); border-radius: var(--radius); font-size:.95rem; color: var(--text); outline:none; transition: var(--trans); }
      .search-wrap input:focus { border-color: var(--accent); box-shadow:0 0 0 3px rgba(78,162,245,.25); }
      .search-wrap svg { position:absolute; left:.9rem; top:50%; transform:translateY(-50%); width:1.1rem; height:1.1rem; stroke: var(--text-dim); }
      main { padding: 0 clamp(2rem,4vw,4rem) clamp(3rem,5vw,4rem); }
      #appsGrid { list-style:none; margin:0; padding:0; display:grid; gap:1.3rem; grid-template-columns:repeat(auto-fill,minmax(240px,1fr)); }
      #appsGrid li { position:relative; }
      .app-card { display:flex; flex-direction:column; gap:.55rem; padding:1.1rem 1rem 1rem; background: var(--bg-alt); border:1px solid var(--border); border-radius: var(--radius); text-decoration:none; color: var(--text); box-shadow: var(--shadow); isolation:isolate; overflow:hidden; transition: var(--trans); }
      .app-card:before { content:""; position:absolute; inset:0; background: radial-gradient(circle at 30% 20%, rgba(78,162,245,.15), transparent 60%); opacity:0; transition: var(--trans); }
      .app-card:hover:before { opacity:1; }
      .app-card:hover { transform: translateY(-4px); border-color: var(--accent); box-shadow: 0 6px 22px -6px rgba(0,0,0,.55), 0 4px 10px -4px rgba(0,0,0,.5); }
      .app-title { font-weight:600; font-size:1.05rem; letter-spacing:.4px; display:flex; align-items:center; gap:.5rem; }
      .app-title svg { width:1rem; height:1rem; stroke: var(--accent); }
      .app-desc { font-size:.75rem; color: var(--text-dim); line-height:1.4; }
      .empty { margin-top:2rem; text-align:center; color:#ff7b7b; font-weight:500; }
      footer { padding:1.5rem 0 0; margin-top:2.5rem; font-size:.7rem; text-align:center; color: var(--text-dim); }
      @media (max-width:620px){ header{padding:1.4rem 1.25rem .75rem;} main{padding:0 1.25rem 2.5rem;} }
      @media (prefers-color-scheme: light){ :root { --bg:#f6f8fa; --bg-alt:#ffffff; --bg-hover:#f0f4f8; --border:#d0d7de; --text:#24292f; --text-dim:#57606a; --accent:#0969da; --accent-grad:linear-gradient(135deg,#0969da,#7d4bd6 60%,#d63384); --shadow:0 2px 10px -4px rgba(0,0,0,.12),0 1px 4px -2px rgba(0,0,0,.08);} .app-card{box-shadow:0 3px 14px -4px rgba(0,0,0,.15);} .app-card:hover{box-shadow:0 6px 26px -6px rgba(0,0,0,.18);} }
      .badge { display:inline-block; padding:.2rem .5rem; font-size:.6rem; letter-spacing:.5px; background:rgba(78,162,245,.15); color:var(--accent); border:1px solid var(--accent); border-radius:999px; }
    </style>
  </head>
  <body>
    <header>
      <h1>Danh sách Web App</h1>
      <p class="muted">Chọn ứng dụng để mở. Mỗi app nằm trong thư mục <code>webapp/&lt;tên-app&gt;</code>. Dùng ô tìm kiếm để lọc nhanh.</p>
      <div class="toolbar">
        <div class="search-wrap">
          <svg fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><circle cx="11" cy="11" r="7"/><path d="m21 21-4.35-4.35"/></svg>
          <input id="search" placeholder="Tìm ứng dụng..." autocomplete="off" />
        </div>
      </div>
    </header>
    <main>
      <ul id="appsGrid"></ul>
      <p id="empty" class="empty" style="display:none">Chưa có ứng dụng nào trong thư mục <code>webapp/</code>.</p>
    </main>
    <footer>© <span id="year"></span> Gemini Proxy Webapps</footer>

    <script>
      function detectApiPrefix(){
        // Derive API prefix from current path by trimming at "/webapp"
        try{
          const path = window.location.pathname;
          const markerIdx = path.indexOf('/webapp');
          if(markerIdx > -1){
            return path.substring(0, markerIdx).replace(/\/$/, '');
          }
        }catch(_){/* ignore */}
        // Fallbacks
        if (window.APP_API_PREFIX) return String(window.APP_API_PREFIX).replace(/\/$/, '');
        return '';
      }

      const state = { apps: [], prefix: '' };

      async function loadApps(){
        try{
          state.prefix = detectApiPrefix();
          const res = await fetch(`${state.prefix}/webapp/_list`);
          if(!res.ok){ throw new Error("Failed to load app list"); }
          const data = await res.json();
          state.apps = Array.isArray(data) ? data : [];
          renderApps();
        }catch(err){
          console.error(err);
          document.getElementById('empty').style.display = '';
        }
      }

      function renderApps(filter=''){
        const grid = document.getElementById('appsGrid');
        grid.innerHTML='';
        const apps = state.apps.filter(a => a.toLowerCase().includes(filter.toLowerCase()));
        if(apps.length === 0){
          document.getElementById('empty').style.display='';
          return;
        }
        document.getElementById('empty').style.display='none';
        apps.forEach(name => {
          const li = document.createElement('li');
          const a = document.createElement('a');
          a.className='app-card';
          a.href = `${state.prefix}/webapp/${encodeURIComponent(name)}`;
          a.innerHTML = `
            <div class="app-title">
              <svg fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M12 3 4 9v12h16V9z"/><path d="M12 22V12"/></svg>
              <span>${name}</span>
            </div>
            <div class="app-desc">Ứng dụng tĩnh: <span class="badge">HTML</span> <span class="badge">JS</span> <span class="badge">CSS</span></div>
          `;
          li.appendChild(a);
          grid.appendChild(li);
        });
      }

      function initSearch(){
        const input = document.getElementById('search');
        input.addEventListener('input', e => {
          renderApps(e.target.value.trim());
        });
      }
      function initYear(){ document.getElementById('year').textContent = new Date().getFullYear(); }

      async function bootstrap(){
        initSearch();
        initYear();
        await loadApps();
      }
      bootstrap();
    </script>
  </body>
</html>
